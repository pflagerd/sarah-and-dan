!function(){"use strict";"undefined"==typeof globalThis&&(window.globalThis=window),(()=>{if(!globalThis.browser&&globalThis.chrome){const e=globalThis.chrome;globalThis.__defineGetter__("browser",(()=>({action:{onClicked:{addListener:t=>e.action.onClicked.addListener(t)},setBadgeText:t=>e.action.setBadgeText(t),setBadgeBackgroundColor:t=>e.action.setBadgeBackgroundColor(t),setTitle:t=>e.action.setTitle(t),setIcon:t=>e.action.setIcon(t)},bookmarks:{get:t=>e.bookmarks.get(t),onCreated:{addListener:t=>e.bookmarks.onCreated.addListener(t),removeListener:t=>e.bookmarks.onCreated.removeListener(t)},onChanged:{addListener:t=>e.bookmarks.onChanged.addListener(t),removeListener:t=>e.bookmarks.onChanged.removeListener(t)},onMoved:{addListener:t=>e.bookmarks.onMoved.addListener(t),removeListener:t=>e.bookmarks.onMoved.removeListener(t)},update:(t,n)=>e.bookmarks.update(t,n)},commands:{onCommand:{addListener:t=>e.commands.onCommand.addListener(t)}},downloads:{download:t=>e.downloads.download(t),onChanged:{addListener:t=>e.downloads.onChanged.addListener(t),removeListener:t=>e.downloads.onChanged.removeListener(t)},search:t=>e.downloads.search(t)},i18n:{getUILanguage:()=>e.i18n.getUILanguage(),getMessage:(t,n)=>e.i18n.getMessage(t,n)},identity:{getRedirectURL:()=>e.identity.getRedirectURL(),getAuthToken:t=>e.identity.getAuthToken(t),launchWebAuthFlow:t=>e.identity.launchWebAuthFlow(t),removeCachedAuthToken:t=>e.identity.removeCachedAuthToken(t)},contextMenus:{onClicked:{addListener:t=>e.contextMenus.onClicked.addListener(t)},create:t=>e.contextMenus.create(t),update:(t,n)=>e.contextMenus.update(t,n),removeAll:()=>e.contextMenus.removeAll()},permissions:{request:t=>e.permissions.request(t),remove:t=>e.permissions.remove(t)},runtime:{id:e.runtime.id,sendNativeMessage:(t,n)=>new Promise(((a,r)=>{e.runtime.sendNativeMessage(t,n,(t=>{e.runtime.lastError?r(e.runtime.lastError):a(t)}))})),getManifest:()=>e.runtime.getManifest(),onMessage:{addListener:t=>e.runtime.onMessage.addListener(((e,n,a)=>{const r=t(e,n);if(r&&"function"==typeof r.then)return r.then((e=>{if(void 0!==e)try{a(e)}catch(e){}})),!0})),removeListener:t=>e.runtime.onMessage.removeListener(t)},onMessageExternal:{addListener:t=>e.runtime.onMessageExternal.addListener(((e,n,a)=>{const r=t(e,n);if(r&&"function"==typeof r.then)return r.then((e=>{if(void 0!==e)try{a(e)}catch(e){}})),!0}))},sendMessage:t=>new Promise(((n,a)=>{e.runtime.sendMessage(t,(t=>{e.runtime.lastError?a(e.runtime.lastError):n(t)})),e.runtime.lastError&&a(e.runtime.lastError)})),getURL:t=>e.runtime.getURL(t),getContexts:t=>e.runtime.getContexts(t),get lastError(){return e.runtime.lastError}},scripting:{executeScript:t=>e.scripting.executeScript(t)},storage:{local:{set:t=>e.storage.local.set(t),get:t=>e.storage.local.get(t),clear:()=>e.storage.local.clear(),remove:t=>e.storage.local.remove(t)},sync:{set:t=>e.storage.sync.set(t),get:t=>e.storage.sync.get(t),clear:()=>e.storage.sync.clear(),remove:t=>e.storage.sync.remove(t)}},tabs:{onCreated:{addListener:t=>e.tabs.onCreated.addListener(t)},onActivated:{addListener:t=>e.tabs.onActivated.addListener(t)},onUpdated:{addListener:t=>e.tabs.onUpdated.addListener(t),removeListener:t=>e.tabs.onUpdated.removeListener(t)},onRemoved:{addListener:t=>e.tabs.onRemoved.addListener(t),removeListener:t=>e.tabs.onRemoved.removeListener(t)},onReplaced:{addListener:t=>e.tabs.onReplaced.addListener(t),removeListener:t=>e.tabs.onReplaced.removeListener(t)},captureVisibleTab:(t,n)=>e.tabs.captureVisibleTab(t,n),sendMessage:(t,n,a={})=>new Promise(((r,o)=>{e.tabs.sendMessage(t,n,a,(t=>{e.runtime.lastError?o(e.runtime.lastError):r(t)})),e.runtime.lastError&&o(e.runtime.lastError)})),query:t=>e.tabs.query(t),create:t=>e.tabs.create(t),get:t=>e.tabs.get(t),remove:t=>e.tabs.remove(t),update:(t,n)=>e.tabs.update(t,n)},devtools:{inspectedWindow:{onResourceContentCommitted:{addListener:t=>e.devtools.inspectedWindow.onResourceContentCommitted.addListener(t)},get tabId(){return e.devtools.inspectedWindow.tabId}}},offscreen:{createDocument:t=>e.offscreen.createDocument(t)},declarativeNetRequest:{updateSessionRules:t=>e.declarativeNetRequest.updateSessionRules(t)}})))}})();const e=[0],t=Symbol(),n=new TextEncoder,a=new TextDecoder,r=new Array(256);let o=0;function s(t,n,a,s){if(void 0===s){if(o++,!(r.length-o>=e.length))throw new Error("Reached maximum number of custom types");r[r.length-o]={serialize:t,parse:n,test:a}}else r[s]={serialize:t,parse:n,test:a}}async function i(e,t){const n=r.findIndex((({test:n}={})=>n&&n(t,e)));e.addObject(t),await e.append(new Uint8Array([n]));const a=r[n].serialize;a&&await a(e,t),0!=n&&U(t)&&(await async function(e,t){const n=Object.getOwnPropertySymbols(t),a=n.map((e=>[e,t[e]]));await c(e,a)}(e,t),await async function(e,t){if(ArrayBuffer.isView(t))await i(e,0);else{let n=Object.entries(t);R(t)&&(n=n.filter((([e])=>!j(Number(e))))),await i(e,n.length);for(const[t,a]of n)await u(e,t),await i(e,a)}}(e,t))}async function c(e,n){await i(e,n.length);const a=Object.keys(n).filter((e=>j(Number(e)))).map((e=>Number(e)));let r=0,o=a[r];for(const[s,c]of n.entries())o==s?(o=a[++r],await i(e,c)):await i(e,t)}async function u(e,t){const a=n.encode(t);await i(e,a.length),await e.append(a)}async function f(e,t){await i(e,t.length),await e.append("Uint8Array"==t.constructor.name?t:new Uint8Array(t.buffer))}async function d(e,t){const n=new Uint8Array(new Float64Array([t]).buffer);await e.append(n)}async function w(e,t){const n=new Uint8Array([Number(t)]);await e.append(n)}s((async function(e,t){const n=e.objects.indexOf(t);await i(e,n)}),(async function(e){const t=await b(e);return new l(t,e)}),(function(e,t){return U(e)&&t.objects.includes(e)}),0),s(null,(function(){return{}}),U),s(c,h,R),s(u,p,(function(e){return"string"==typeof e})),s(f,(async function(e){const t=await b(e),n=await e.consume(8*t);return new Float64Array(n.buffer)}),(function(e){return"Float64Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(4*t);return new Float32Array(n.buffer)}),(function(e){return"Float32Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(4*t);return new Uint32Array(n.buffer)}),(function(e){return"Uint32Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(4*t);return new Int32Array(n.buffer)}),(function(e){return"Int32Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(2*t);return new Uint16Array(n.buffer)}),(function(e){return"Uint16Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(2*t);return new Int16Array(n.buffer)}),(function(e){return"Int16Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(t);return new Uint8ClampedArray(n.buffer)}),(function(e){return"Uint8ClampedArray"==e.constructor.name})),s(f,(async function(e){const t=await b(e);return await e.consume(t)}),(function(e){return"Uint8Array"==e.constructor.name})),s(f,(async function(e){const t=await b(e),n=await e.consume(t);return new Int8Array(n.buffer)}),(function(e){return"Int8Array"==e.constructor.name})),s((async function(e,t){await i(e,t.byteLength),await e.append(new Uint8Array(t))}),(async function(e){const t=await b(e);return(await e.consume(t)).buffer}),(function(e){return"ArrayBuffer"==e.constructor.name})),s(d,v,C),s((async function(e,t){const n=new Uint8Array(new Uint32Array([t]).buffer);await e.append(n)}),(async function(e){const t=await e.consume(4);return new Uint32Array(t.buffer)[0]}),(function(e){return j(e)&&e>=0&&e<=4294967295})),s((async function(e,t){const n=new Uint8Array(new Int32Array([t]).buffer);await e.append(n)}),(async function(e){const t=await e.consume(4);return new Int32Array(t.buffer)[0]}),(function(e){return j(e)&&e>=-2147483648&&e<=2147483647})),s((async function(e,t){const n=new Uint8Array(new Uint16Array([t]).buffer);await e.append(n)}),(async function(e){const t=await e.consume(2);return new Uint16Array(t.buffer)[0]}),(function(e){return j(e)&&e>=0&&e<=65535})),s((async function(e,t){const n=new Uint8Array(new Int16Array([t]).buffer);await e.append(n)}),(async function(e){const t=await e.consume(2);return new Int16Array(t.buffer)[0]}),(function(e){return j(e)&&e>=-32768&&e<=32767})),s((async function(e,t){const n=new Uint8Array([t]);await e.append(n)}),(async function(e){const t=await e.consume(1);return new Uint8Array(t.buffer)[0]}),(function(e){return j(e)&&e>=0&&e<=255})),s((async function(e,t){const n=new Uint8Array(new Int8Array([t]).buffer);await e.append(n)}),(async function(e){const t=await e.consume(1);return new Int8Array(t.buffer)[0]}),(function(e){return j(e)&&e>=-128&&e<=127})),s(null,(function(){return}),(function(e){return void 0===e})),s(null,(function(){return null}),(function(e){return null===e})),s(null,(function(){return NaN}),(function(e){return Number.isNaN(e)})),s(w,L,(function(e){return"boolean"==typeof e})),s((async function(e,t){await u(e,t.description)}),(async function(e){const t=await p(e);return Symbol(t)}),x),s(null,(function(){return t}),k),s((async function(e,t){const n=t.entries();await i(e,t.size);for(const[t,a]of n)await i(e,t),await i(e,a)}),(async function(e){const t=await b(e),n=new Map;t&&await async function a(r=0){const o=await b(e),s=await b(e);e.setObject([o,s],((e,t)=>n.set(e,t))),r<t-1&&await a(r+1)}();return n}),(function(e){return e instanceof Map})),s((async function(e,t){await i(e,t.size);for(const n of t)await i(e,n)}),(async function(e){const t=await b(e),n=new Set;t&&await async function a(r=0){const o=await b(e);e.setObject([o],(e=>n.add(e))),r<t-1&&await a(r+1)}();return n}),(function(e){return e instanceof Set})),s((async function(e,t){await d(e,t.getTime())}),(async function(e){const t=await v(e);return new Date(t)}),(function(e){return e instanceof Date})),s((async function(e,t){await u(e,t.message),await u(e,t.stack)}),(async function(e){const t=await p(e),n=await p(e),a=new Error(t);return a.stack=n,a}),(function(e){return e instanceof Error})),s((async function(e,t){await u(e,t.source),await u(e,t.flags)}),(async function(e){const t=await p(e),n=await p(e);return new RegExp(t,n)}),(function(e){return e instanceof RegExp})),s((async function(e,t){await u(e,t.valueOf())}),(async function(e){return new String(await p(e))}),(function(e){return e instanceof String})),s((async function(e,t){await d(e,t.valueOf())}),(async function(e){return new Number(await v(e))}),(function(e){return e instanceof Number})),s((async function(e,t){await w(e,t.valueOf())}),(async function(e){return new Boolean(await L(e))}),(function(e){return e instanceof Boolean}));class l{constructor(e,t){this.index=e,this.data=t}getObject(){return this.data.objects[this.index]}}class m{constructor(e){this.stream=new y(e),this.objects=[],this.setters=[]}consume(e){return this.stream.consume(e)}getObjectId(){const e=this.objects.length;return this.objects.push(void 0),e}resolveObject(e,t){(function(e){return U(e)||x(e)})(t)&&!A(t)&&(this.objects[e]=t)}setObject(e,t){this.setters.push({functionArguments:e,setterFunction:t})}executeSetters(){this.setters.forEach((({functionArguments:e,setterFunction:t})=>{t(...e.map((e=>A(e)?e.getObject():e)))}))}}class y{constructor(e){this.offset=0,this.value=new Uint8Array(0),this.consumeData=e}async consume(e){if(this.offset+e>this.value.length){const t=new Uint8Array(this.value).subarray(this.offset,this.value.length),n=await this.consumeData();return t.length+n.length!=this.value.length&&(this.value=new Uint8Array(t.length+n.length)),this.value.set(t),this.value.set(n,t.length),this.offset=0,this.consume(e)}{const t=this.value.slice(this.offset,this.offset+e);return this.offset+=t.length,t}}}function g(){let e,t,n,a,r,o;return{next:async t=>t?async function(t){r?await r:async function(){let t;a=new Promise((e=>t=e)),e=new m(i),s();const n=await b(e);e.executeSetters(),t(n)}().catch((()=>{}));return function(){r=new Promise((e=>o=e))}(),n(t),{done:!1}}(t):{value:await a,done:!0},return:()=>({done:!0})};function s(){t=new Promise((e=>n=e))}async function i(){const e=await t;return s(),o&&o(),e}}async function b(e){const t=(await e.consume(1))[0],n=r[t].parse,a=e.getObjectId(),o=await n(e);return 0!=t&&U(o)&&(await async function(e,t){const n=await h(e);e.setObject([n],(e=>e.forEach((([e,n])=>t[e]=n))))}(e,o),await async function(e,t){const n=await b(e);n&&await a();async function a(r=0){const o=await p(e),s=await b(e);e.setObject([s],(e=>t[o]=e)),r<n-1&&await a(r+1)}}(e,o)),e.resolveObject(a,o),o}async function h(e){const t=await b(e),n=new Array(t);return t&&await async function a(r=0){const o=await b(e);k(o)||e.setObject([o],(e=>n[r]=e));r<t-1&&await a(r+1)}(),n}async function p(e){const t=await b(e),n=await e.consume(t);return a.decode(n)}async function v(e){const t=await e.consume(8);return new Float64Array(t.buffer)[0]}async function L(e){const t=await e.consume(1);return Boolean(t[0])}function A(e){return e instanceof l}function U(e){return e===Object(e)}function R(e){return"number"==typeof e.length}function k(e){return e===t}function C(e){return"number"==typeof e}function j(e){return C(e)&&Number.isInteger(e)}function x(e){return"symbol"==typeof e}const I=globalThis.singlefile,M=new Map,O=new Map;function T(e,t={}){return new Promise(((n,a)=>{const r=new XMLHttpRequest;if(r.withCredentials=!0,r.responseType="arraybuffer",r.onerror=e=>a(new Error(e.detail)),r.onreadystatechange=()=>{r.readyState==XMLHttpRequest.DONE&&n({status:r.status,headers:{get:e=>r.getResponseHeader(e)},arrayBuffer:async()=>r.response})},r.open("GET",e,!0),t.headers)for(const e of Object.entries(t.headers))r.setRequestHeader(e[0],e[1]);r.send()}))}function E({requestId:e,truncated:t,finished:n,data:a}){let r;if(t?(r=O.get(e),r||(r=[],O.set(e,r)),r.push(new Uint8Array(a)),n&&O.delete(e)):a&&(r=[new Uint8Array(a)]),!t||n)return r}browser.runtime.onMessage.addListener((async({method:e,truncated:t,finished:n,requestId:a,url:r,data:o,mimeType:s,options:i,width:c,height:u,tabId:f})=>{if("processPage"==e){const e=await I.getPageData(i,{fetch:T},null,null),t=new Blob(["string"==typeof e.content?e.content:new Uint8Array(e.content)],{type:e.mimeType});return{url:URL.createObjectURL(t),archiveTime:e.archiveTime,doctype:e.doctype,filename:e.filename,title:e.title}}if("compressPage"==e){let e=M.get(f);if(e||(e=g(),M.set(f,e)),o)return await e.next(new Uint8Array(o)),{};{const t=await e.next();M.delete(f);const n=t.value,a=await I.processors.compression.process(n,i);return URL.createObjectURL(a)}}if("getBlobURL"==e){const e={};s&&(e.type=s);const r=E({requestId:a,truncated:t,finished:n,data:o});return r?URL.createObjectURL(new Blob(r,e)):{}}if("revokeObjectURL"==e)return URL.revokeObjectURL(r),{};if("getImageData"==e){const e=new Image;await new Promise(((t,n)=>{e.onload=t,e.onerror=e=>n(new Error(e.detail)),e.src=r}));const t=document.createElement("canvas");t.width=c,t.height=u;const n=t.getContext("2d");n.drawImage(e,0,0,c,u);const{data:a}=await n.getImageData(0,0,c,u);return{url:URL.createObjectURL(new Blob([a]))}}if("saveToClipboard"==e){const e=E({requestId:a,truncated:t,finished:n,data:o});if(e){const t=new Uint8Array(e.map((e=>e.length)).reduce(((e,t)=>e+t)));for(let n=0,a=0;n<e.length;n++)t.set(e[n],a),a+=e[n].length;!function(e){const t="copy";function n(t){t.clipboardData.setData(e.mimeType,e.content),t.clipboardData.setData("text/plain",e.content),t.preventDefault()}document.addEventListener(t,n),document.execCommand(t),document.removeEventListener(t,n)}({content:(new TextDecoder).decode(t),mimeType:s})}return{}}}))}();
